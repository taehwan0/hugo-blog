name: hugo-blog-deploy

on:
  push:
    branches:
      - master

# 한 번에 하나의 워크플로우만 실행되도록 설정
concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
        # theme submodule를 포함하여 전체 리포지토리를 가져옵니다.
        with:
          submodules: true
          fetch-depth: 0  #
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: 'latest'

      - name: Build
        run: hugo --minify

      - name: Deploy
        uses: appleboy/scp-action@v1
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          password: ${{ secrets.SSH_PASSWORD }}
          port: ${{ secrets.SSH_PORT }}
          source: "./public"
          target: ${{ secrets.TAERGET_PATH}}
          rm: true

